<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.house.springboot.mapper.TbOrderMapper">
    
    <resultMap type="com.house.springboot.bean.TbOrder" id="TbOrderResult">
        <result property="id"    column="id"    />
        <result property="houseId"    column="house_id"    />
        <result property="houseName"    column="housename"    />
        <result property="userId"    column="user_id"    />
        <result property="orderTime"    column="order_time"    />
        <result property="username"    column="username"    />
    </resultMap>

    <sql id="selectTbOrderVo">
        select tbo.id, tbo.house_id, tbo.user_id, tbo.order_time, tbo.username, tbh.house_desc as housename from tb_order tbo
            left join tb_house tbh on tbo.house_id=tbh.id
    </sql>

    <select id="selectTbOrderList" parameterType="com.house.springboot.bean.TbOrder" resultMap="TbOrderResult">
        <include refid="selectTbOrderVo"/>
        <where>  
            <if test="houseId != null "> and tbo.house_id = #{houseId}</if>
            <if test="userId != null "> and tbo.user_id = #{userId}</if>
            <if test="username != null  and username != ''"> and tbo.username like concat('%', #{username}, '%')</if>
        </where>
    </select>
    
    <select id="selectTbOrderById" parameterType="Long" resultMap="TbOrderResult">
        <include refid="selectTbOrderVo"/>
        where tbo.id = #{id}
    </select>
        
    <insert id="insertTbOrder" parameterType="com.house.springboot.bean.TbOrder" useGeneratedKeys="true" keyProperty="id">
        insert into tb_order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="houseId != null">house_id,</if>
            <if test="userId != null">user_id,</if>
            <if test="username != null">username,</if>
            order_time
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="houseId != null">#{houseId},</if>
            <if test="userId != null">#{userId},</if>
            <if test="username != null">#{username},</if>
            sysdate()
         </trim>
    </insert>

    <update id="updateTbOrder" parameterType="com.house.springboot.bean.TbOrder">
        update tb_order
        <trim prefix="SET" suffixOverrides=",">
            <if test="houseId != null">house_id = #{houseId},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="username != null">username = #{username},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteTbOrderById" parameterType="Long">
        delete from tb_order where id = #{id}
    </delete>

</mapper>